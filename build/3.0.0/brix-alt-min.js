KISSY.add("brix/app",function(a,b,c,d,e,f){function g(){g.superclass.constructor.apply(this,arguments)}a.extend(g,f),a.augment(g,b,c,d,{bootStyle:function(b){a.use(this.bxComboStyle().join(","),b)}});var h=new g({});return h.config("Brick",e),h},{requires:["brix/app/config","brix/core/bx-boot","brix/core/bx-find","brix/base","base"]}),KISSY.add("brix/app/config",function(a){function b(a){var b=a.split("/");this.version=b[0],this.assets=b[1]||"all"}a.augment(b,{naked:function(a){return!this.requires(a)},requires:function(a){return"all"===this.assets||this.assets===a},toString:function(){return this.version}});var c={configData:{debug:!0,base:".",imports:{},importsBase:"http://g.tbcdn.cn/thx/m",components:null,namespace:null,timestamp:null},config:function(b,c){var d=this.configData;if(a.isPlainObject(b))c=b,b=null;else if(a.isString(b)){if("undefined"==typeof c)return d[b];var e={};e[b]=c,c=e}return c&&(a.mix(d,c),"components"in c&&this.bxResolveComponents(),"imports"in c&&this.bxResolveImports()),this},bxResolveComponents:function(){var c,d=this.config("components");if(a.isString(d))c=d;else{for(c in d);var e=d[c];if(a.isPlainObject(e))for(var f in e)e[f]=new b(e[f])}this.config("namespace",c),this.bxPackageComponents(),this.bxMapComponents()},bxResolveImports:function(){var a=this.config("imports");for(var c in a){var d=a[c];for(var e in d)d[e]=new b(d[e])}this.bxPackageImports(),this.bxMapImports()},bxMapImports:function(){this.bxMapModules(this.config("imports"))},bxMapComponents:function(){var b=this.config("timestamp"),c=this.config("namespace"),d=this.config("components");if(b&&c){var e=function(a,d,e){return[c,b,d,e].join("/")};a.config("map",[[new RegExp(c+"\\/([^\\/]+)\\/([^\\/]+)$"),e]])}else a.isPlainObject(d)&&this.bxMapModules(d)},bxMapModules:function(b){function c(a){return function(c,d,e){return[a,d,b[a][d],e].join("/")}}var d=[];for(var e in b)d.push([new RegExp(e+"\\/([^\\/]+)\\/([^\\/]+)$"),c(e)]);a.config("map",d)},bxPackageImports:function(){var b=this.config("imports"),c=this.config("importsBase"),d=a.config("ignorePackageNameInUri"),e={};for(var f in b)e[f]={base:c+(d?"/"+f:"")};a.config("packages",e)},bxPackageComponents:function(){var b=this.config("namespace");if(!a.config("packages")[b]){var c=this.config("base"),d=a.config("ignorePackageNameInUri"),e={};e[b]={base:c+(d?"/"+b:"")},a.config("packages",e)}},bxComboStyle:function(){var b,c=this.config("imports")||{},d=[],e=function(a,b){for(var c in b)b[c].requires("css")&&d.push([a,c,"index.css"].join("/"))};for(b in c)e(b,c[b]);var f=this.config("components");if(b=this.config("namespace"),f=f[b],a.isPlainObject(f))e(b,f);else if(a.isArray(f))for(var g=0;g<f.length;g++)d.push([b,f[g],"index.css"].join("/"));return d}};return c}),KISSY.add("brix/base",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=a.noop,r=a.DOM,s=["remove","empty"],t=o.extend({initializer:function(){var a=this,b=a.get("el");a.set("id",b.attr("id"),{silent:!0}),a.get("name")||a.set("name",b.attr("bx-name"),{silent:!0}),a.bxIgnite()},bxIgnite:function(){var b=this,c=new n.Defer,d=c.promise;return d=d.then(function(){return b.bxGetData()}).then(function(){return b.bxAfterGetData()}).then(function(){return b.bxBuildData()}).then(function(){return b.bxGetTpl()}).then(function(){return b.bxAfterGetTpl()}).then(function(){return b.bxBuildTpl()}).then(function(){return b.bxRender()}).fail(function(a){throw a}),b.get("passive")||d.then(function(){return b.bxActivate()}),a.later(function(){c.resolve(!0)},0),b},bind:q,sync:q,bxGetTpl:function(){var a=new n.Defer,b=this;return b.bxHandleTpl(function(c){c&&b.set("tpl",c),a.resolve(c)}),a.promise},bxAfterGetTpl:function(){var a=this,b=new n.Defer,c=a.fire("getTpl",{next:function(c){c&&a.set("tpl",c),b.resolve(c)}});return c?b.promise:void 0},bxBuildTpl:function(){return this.bxIBuildTpl?this.bxIBuildTpl():void 0},bxGetData:function(){var a=new n.Defer,b=this;return b.bxHandleRemote(function(c){c&&b.set("data",c),a.resolve(c)}),a.promise},bxAfterGetData:function(){var a=new n.Defer,b=this,c=b.fire("getData",{next:function(c){c&&b.set("data",c),a.resolve(c)}});return c?a.promise:void 0},bxBuildData:function(){var a=this,b=a.get("data");return b?!0:void 0},bxRender:function(){var b=this;if(b.get("autoRender")&&!b.get("rendered")){var c=new n.Defer;b.fire("beforeRender");var d=b.get("tpl"),e=b.get("el");if(d){var f=a.trim(b.bxRenderTpl(d,b.get("data")));e.html(f)}return b.bxDelegate(),b.once("rendered",function(){b.fire("afterRender"),c.resolve()}),b.bxHandleName(e,function(){b.setInternal("rendered",!0),b.fire("rendered")}),c.promise}},bxRenderTpl:function(a,b){var c=this,d=c.get("TplEngine");if("function"==typeof d){var e=c.get("commands");return new d(a,{commands:e||{}}).render(b)}return d.render(a,b)},bxActivate:function(){function b(){d.setInternal("ready",!0),d.fire("ready")}function c(){++g===f&&b()}var d=this;if(d.get("autoActivate")&&!d.get("activated")&&d.get("rendered")){d.bxBind(),d.bxSync(),d.bxIActivate&&d.bxIActivate(),d.setInternal("activated",!0);for(var e=d.get("children"),f=e.length,g=0,h=0;h<e.length;h++){var i=e[h];i.once("ready",c),i.bxActivate()}e&&0!==e.length||a.later(b,0)}},bxBind:function(){var a=this;a.fire("beforeBind"),a.constructor.superclass.bindInternal.call(a),a.callMethodByHierarchy("bind","__bind"),a.fire("afterBind")},bxSync:function(){var a=this;a.fire("beforeSync"),t.superclass.syncInternal.call(a),a.callMethodByHierarchy("sync","__sync"),a.fire("afterSync")},destructor:function(){var b,c=this,d=c.get("children");for(b=d.length-1;b>=0;b--)d[b].destroy();c.set("children",[]);var e=c.get("parent");if(e){var f=e.get("children"),g=c.get("id");for(b=f.length-1;b>=0;b--)if(f[b].get("id")===g){f.splice(b,1);break}}if(c.get("rendered")){var h=c.get("el");if(c.bxUndelegate(),h&&r.contains(document,h[0])){var i=c.get("destroyAction");a.inArray(i,s)&&h[i]()}}c.set("destroyed",!0)},fire:function(a,b,c){var d=t.superclass.fire.apply(this,arguments),e=this.get("parent");if(e)if(c=c||this,c===this){var f="#"+c.get("id")+"_"+a,g=c.get("name")+"_"+a;e.fire(f,b,c),e.fire(g,b,c)}else e.fire(a,b,c);return d},once:function(a,b,c){var d=this,e=function(){d.detach(a,e),b.apply(this,arguments)};return d.on(a,e,c),d},dirtyCheck:function(a){var b=this;if("function"!=typeof a&&(a=b[a]),!a)throw new Error("没有找到对应的函数");a.apply(b,Array.prototype.slice.call(arguments,1)),b.digest()}},{ATTRS:a.mix(a.mix({tpl:{value:null},data:{value:{}},rendered:{value:!1},activated:{value:!1},el:{getter:function(b){return a.isString(b)&&(b=a.one(b)),b},setter:function(b){if(a.isString(b)&&(b=a.one(b)),!b.attr("id")){for(var c;(c=a.guid("brix-brick-"))&&a.one("#"+c););b.attr("id",c)}return"#"+b.attr("id")}},id:{value:null},name:{value:null},autoRender:{value:!0},autoActivate:{value:!0},passive:{value:!1},config:{value:{}},TplEngine:{value:p},destroyed:{value:!1},destroyAction:{value:"none"},events:{},children:{value:[]},parent:{value:!1}},c.ATTRS),m.ATTRS)},"Brick");return a.augment(t,d,e,f,g,h,i,j,k,l,m,c.METHODS),t},{requires:["brix/app/config","brix/interface/index","brix/core/bx-util","brix/core/bx-tpl","brix/core/bx-name","brix/core/bx-event","brix/core/bx-delegate","brix/core/bx-config","brix/core/bx-remote","brix/core/bx-boot","brix/core/bx-find","brix/core/bx-watcher","promise","rich-base","xtemplate","node","event","sizzle"]}),KISSY.add("brix/core/bx-boot",function(a,b){var c={bxBootOptions:function(b,c){var d;return a.isPlainObject(b)?(c=null,d=b):d=a.isString(b)?{el:b,data:c}:{},b=d.el||"[bx-app]",a.isString(b)&&(d.el=b=a.one(b)),b&&(d.parent=this),b=d.el,b.removeAttr("bx-defer"),d},bxBootName:function(a){var b=a.attr("bx-name"),c=a.hasAttr("bx-naked")&&(a.attr("bx-naked")||"all");return b=b&&"all"!==c&&"js"!==c?b.split("/").length>2?b:b+"/index":"brix/base"},bxBoot:function(a,b){var c=this.get("children"),d=a.el;c||(c=[],this.set("children",c));var e=this.find("#"+d.attr("id"));return e&&e.destroy(),e=new b(a),c.push(e),e},boot:function(c,d){var e=this,f=e.bxBootOptions(c,d),g=new b.Defer,h=this.bxBootName(f.el);return a.use(h,function(a,b){g.resolve(e.bxBoot(f,b))}),g.promise},prepare:function(a,c){var d=new b.Defer;return this.boot(a,c).then(function(a){a.once("ready",function(){d.resolve(this)})}),d.promise}};return c},{requires:["promise"]}),KISSY.add("brix/core/bx-config",function(a){var b={bxHandleConfig:function(a,b){var c=a.attr("bx-config");return c?new Function("return "+c)():{}},bxCastString:function(b){return b=a.trim(b),/^(?:true|false)$/.test(b)?"true"===b:/^\d+$/.test(b)?parseInt(b,10):b}};return b}),KISSY.add("brix/core/bx-delegate",function(){var a={delegate:function(a,b,c,d){this.on(a+"_"+b,c,d)},undelegate:function(a,b,c,d){this.detach(a+"_"+b,c,d)}};return a},{requires:["event"]}),KISSY.add("brix/core/bx-event",function(a){var b={bxDelegate:function(){for(var a=this.constructor;a;)this.bxDelegateMap(a.EVENTS),a=a.superclass?a.superclass.constructor:null;var b=this.get("events");b&&this.bxDelegateMap(b)},bxDelegateMap:function(b){function c(a){return function(){arguments[0].brixData=f.get("data"),a.apply(this,arguments),f.digest()}}var d,e,f=this,g=this.get("el"),h=a.Event;for(var i in b){var j=b[i];for(var k in j)d=j[k],d.handle=c(d),e=d.handle,"self"===i?g.on(k,e,this):"window"===i?h.on(window,k,e,this):"body"===i?h.on("body",k,e,this):"document"===i?h.on(document,k,e,this):g.delegate(k,i,e,this)}},bxUndelegate:function(){for(var a=this.constructor;a;)this.bxUndelegateMap(a.EVENTS),a=a.superclass?a.superclass.constructor:null;var b=this.get("events");b&&this.bxUndelegateMap(b)},bxUndelegateMap:function(b){var c,d=this.get("el"),e=a.Event;for(var f in b){var g=b[f];for(var h in g)c=g[h].handle,"self"===f?d.detach(h,c,this):"window"===f?e.detach(window,h,c,this):"body"===f?e.detach("body",h,c,this):"document"===f?e.detach(document,h,c,this):d.undelegate(h,f,c,this),c=null,delete g[h].handle}}};return b},{requires:["event"]}),KISSY.add("brix/core/bx-find",function(){var a={find:function(a){var b,c=this.get("children");"#"===a.charAt(0)&&(b=a.substr(1),a=null);for(var d=0;d<c.length;d++){var e=c[d];if(e.get("id")===b||e.get("name")===a)return e}},where:function(a){for(var b=this.get("children"),c=[],d=a.name,e=a.selector,f=0;f<b.length;f++){var g=b[f];g.get("name")===d&&c.push(g),e&&g.get("el").test(e)&&c.push(g)}return c}};return a}),KISSY.add("brix/core/bx-name",function(a,b){var c={bxHandleName:function(c,d,e){c=b(c);for(var f=this.bxDirectChildren(c),g=this,h=f.length-1;h>=0;h--){var i=f[h];if(i.hasAttr("bx-defer"))f.splice(h,1);else{var j=g.find("#"+i.attr("id"));j&&f.splice(h,1)}}0===f.length?a.later(function(){d(),e&&e()},0):g.bxUseModules(f,d,e)},bxUseModules:function(a,c,d){for(var e=this,f=0,g=0,h=a.length,i=[],j=function(){++f===h&&c()},k=d&&function(){++g===h&&d()},l=0;h>l;l++){var m=b(a[l]),n=m.hasAttr("bx-naked")&&(m.attr("bx-naked")||"all"),o=m.attr("bx-name");i[l]="js"===n||"all"===n?"brix/base":o.split("/").length>2?o:o+"/index"}KISSY.use(i.join(","),function(b){var c=b.makeArray(arguments);c.shift();for(var d=0;d<c.length;d++)e.bxInstantiate(a[d],c[d],j,k)})},bxInstantiate:function(b,c,d,e){var f=this,g=a.DOM,h=function(){d(),e&&e()};if(!a.isFunction(c))return h();if(!b||!g.contains(document,b[0]))return h();var i=f.bxHandleConfig(b,c),j=b.attr("bx-tag");a.mix(i,{el:b,name:b.attr("bx-name"),parent:f,passive:!e,tag:j,brickTpl:j?f.get("brickTpls")[j].middle:null});for(var k=f;k;){var l=k.get("config");l&&(a.mix(i,l[b.attr("id")]),a.mix(i,l[b.attr("name")])),k=k.get("parent")}var m=new c(i),n=f.get("children");n||(n=[],f.set("children",n)),n.push(m),m.bxRender?(m.once("rendered",d),e&&m.once("ready",e),m.once("destroy",h)):h(),b=n=null},bxDirectChildren:function(a,b){function c(a){for(var e=a.children(),f=0;f<e.length;f++){var g=e.item(f);g.test(b)?d.push(g):c(g)}}var d=[];return b=b||"[bx-name]",c(a),d}};return c},{requires:["node","sizzle","event"]}),KISSY.add("brix/core/bx-remote",function(a,b,c,d){var e={bxHandleRemote:function(c){var e=this,f=e.get("el"),g=f.attr("bx-remote");if(/^http/.test(g)){var h=new d(g);h.isSameOriginAs(new d(location.href))||e.bxJsonpRemote(h,c)}else{if(!/^\.\//.test(g))return c(e.get("data"));var i=e.get("name"),j=i.replace(/\/?$/,"")+g.substr(1);b.config("debug")?e.bxXhrRemote(j,c):a.use(j,function(a,b){c(b)})}},bxJsonpRemote:function(a,b){for(var d,e=a.getQuery(),f=e.keys(),g=0;g<f.length;g++){var h=f[g];if("callback"===h||"callback"===e.get(h)){d=h,e.remove(h);break}}c({dataType:"jsonp",url:a.toString(),jsonp:d,success:b})},bxXhrRemote:function(a,b){if(!/^http/.test(location.href))throw Error("Cannot load data.json via xhr in current mode.");c.get(this.bxResolveModule(a,".json"),b)}};return e},{requires:["brix/app/config","ajax","uri"]}),KISSY.add("brix/core/bx-tpl",function(a,b,c){var d={bxHandleTpl:function(a){var b=this,c=b.get("el"),d=b.get("tpl")||c.attr("bx-tpl");if(d)if("#"===d.charAt(0))b.bxScriptTpl(d,a);else if("."===d)b.bxHereTpl(c,a);else if(/^\.\//.test(d))b.bxRemoteTpl(c.attr("bx-name").replace(/\/?$/,"")+d.substr(1),a);else if("cached"===d){for(var e=!1,f=c;(f=f.parent())&&f!==c;){if(f.attr("bx-each")){e=!0;break}if(f.attr("bx-name"))break}var g=b.get("parent").get("subTplsCache");a(e?g[0]:g.shift())}else a(d);else a()},bxScriptTpl:function(b,c){c(a.one(b).html())},bxHereTpl:function(a,b){b(a.html())},bxRemoteTpl:function(c,d){b.config("debug")?this.bxXhrTpl(c,d):a.use(c+".tpl",function(a,b){d(b)})},bxXhrTpl:function(a,b){if(!/^http/.test(location.href))throw Error("Cannot load tpl via xhr in current mode.");c.get(this.bxResolveModule(a,".html"),b)}};return d},{requires:["brix/app/config","ajax","node","sizzle"]}),KISSY.add("brix/core/bx-util",function(a,b){var c={bxResolveModule:function(c,d){var e=c.split("/"),f=e.shift(),g=e.shift(),h=e.shift(),i=a.config("packages")[f].base,j=b.config("components"),k=b.config("imports"),l=a.config("packages"),m=l[f]&&l[f].ignorePackageNameInUri;return m||e.push(f),e.push(g),k&&k[f]?e.push(k[f][g]):j&&a.isPlainObject(j[f])&&e.push(j[f][g]),e.push(h+d),i+e.join("/")}};return c},{requires:["brix/app/config"]}),KISSY.add("brix/core/bx-watcher",function(a,b){function c(a){var b=e[a];return b||(b=e[a]=new Function("context","locals","with(context){if(typeof "+a+' ==="undefined"){return}else{return '+a+"}}")),b}function d(a,b){return function(){var c=b.indexOf(a);c>-1&&b.splice(c,1)}}var e={},f={watch:function(e,f,g){var h,i=this.get("watchers"),j="function"==typeof f?function(){return f(e)}:c(f),k=j(e);return(a.isArray(k)||a.isObject(k))&&(k=b.stringify(k)),h={value:j,context:e,last:k,callback:g,expression:f},i.push(h),d(h,i)},digest:function(){if(this.bxWatcherChecking)throw new Error("Digest phase is already started");this.bxWatcherChecking=!0;var c,d,e,f,g,h=10,i=this.get("watchers");do for(c=!0,d=-1,e=i.length;++d<e;){f=i[d],g=f.value(f.context);var j=g,k=!1;(a.isArray(j)||a.isObject(j))&&(j=b.stringify(j),k=!0),j!==f.last&&(f.callback(g),f.last=j,c=!1)}while(!c&&h--);if(!h)throw new Error("Too much iterations per digest");delete this.bxWatcherChecking},parse:c};return f.ATTRS={watchers:{value:[]}},f},{requires:["json"]}),KISSY.add("brix/interface/index",function(){var a={};return a.METHODS={bxIBuildTpl:function(a){var b=this.bxDirectChildren(a),c=this.get("subTplsCache");c||(c=[],this.set("subTplsCache",c));for(var d=0;d<b.length;d++){var e=b[d],f=e.attr("bx-tpl");!e.attr("bx-model")||f&&"."!==f||(c.push(e.html()),e.html(""),e.attr("bx-tpl","cached"))}}},a.ATTRS={subTplsCache:{value:[]}},a});