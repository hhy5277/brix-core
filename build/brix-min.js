KISSY.add("brix/app",function(a,b,c){function d(){d.superclass.constructor.call(this)}a.extend(d,a.Base),d.ATTRS={prepared:!1},a.augment(d,b,{boot:function(){return this.prepare(),c.boot.apply(this,arguments)},bootStyle:function(b){this.prepare(),a.use(this.bxComboStyle().join(","),b)},prepare:function(){this.get("prepared")||(this.bxMapImports(),this.bxMapComponents(),this.bxPackageImports(),this.bxPackageComponents(),this.set("prepared",!0))}});var e=new d;return e},{requires:["brix/app/config","brix/base","base"]}),KISSY.add("brix/app/config",function(a){function b(a){var b=a.split("/");this.version=b[0],this.assets=b[1]||"all"}a.augment(b,{naked:function(a){return!this.requires(a)},requires:function(a){return"all"===this.assets||this.assets===a},toString:function(){return this.version}});var c={configData:{debug:!0,base:".","interface":"zuomo",imports:{},components:null,namespace:null,timestamp:null},config:function(b,c){var d=this.configData;if(a.isPlainObject(b))c=b,b=null;else if(a.isString(b)){if("undefined"==typeof c)return d[b];var e={};e[b]=c,c=e}return c&&(a.mix(d,c),"components"in c&&this.bxResolveComponents(),"imports"in c&&this.bxResolveImports()),this},bxResolveComponents:function(){var c=this.config("components");if(a.isPlainObject(c))for(var d in c)c[d]=new b(c[d])},bxResolveImports:function(){var a=this.config("imports");for(var c in a){var d=a[c];for(var e in d)d[e]=new b(d[e])}},bxMapImports:function(){this.bxMapModules(this.config("imports"))},bxMapComponents:function(){var b=this.config("timestamp"),c=this.config("namespace"),d=this.config("components");if(b&&c){var e=function(a,d,e){return[c,b,d,e].join("/")};a.config("map",[[new RegExp(c+"\\/([^\\/]+)\\/([^\\/]+)$"),e]])}else if(a.isPlainObject(d)){var f={};f[c]=d,this.bxMapModules(f)}},bxMapModules:function(b){function c(a){return function(c,d,e){return[a,d,b[a][d],e].join("/")}}var d=[];for(var e in b)d.push([new RegExp(e+"\\/([^\\/]+)\\/([^\\/]+)$"),c(e)]);a.config("map",d)},bxPackageImports:function(){var b=this.config("imports"),c=this.config("base")+"/imports",d=a.config("ignorePackageNameInUri"),e={};for(var f in b)e[f]={base:c+(d?"/"+f:"")};a.config("packages",e)},bxPackageComponents:function(){var b=this.config("namespace"),c=this.config("base"),d=a.config("ignorePackageNameInUri"),e={};e[b]={base:c+"/components"+(d?"/"+b:"")},a.config("packages",e)},bxComboStyle:function(){var b,c=this.config("imports")||{},d=[],e=function(a,b){for(var c in b)b[c].requires("css")&&d.push([a,c,"index.css"].join("/"))};for(b in c)e(b,c[b]);var f=this.config("components");if(b=this.config("namespace"),a.isPlainObject(f))e(b,f);else if(a.isArray(f))for(var g=0;g<f.length;g++)d.push([b,f[g],"index.css"].join("/"));return d}};return c}),KISSY.add("brix/base",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=a.noop,o=l.extend({initializer:function(){var b=this,c=b.get("el");b.set("id",c.attr("id"),{silent:!0}),b.get("name")||b.set("name",c.attr("bx-name"),{silent:!0});var d=new k.Defer,e=d.promise;e.then(function(){return b.bxGetTpl()}).then(function(){return b.bxAfterGetTpl()}).then(function(){return b.bxBuildTpl()}).then(function(){return b.bxGetData()}).then(function(){return b.bxAfterGetData()}).then(function(){return b.bxBuildData()}).then(function(){return b.bxRender()}).then(function(){return b.bxActivate()}).then(function(){b.fire("ready")}),a.later(function(){d.resolve(!0)},0)},bind:n,sync:n,bxGetTpl:function(){var a=new k.Defer,b=this;return b.bxHandleTpl(function(b){a.resolve(b)}),a.promise.then(function(a){b.set("tpl",a)}),a.promise},bxAfterGetTpl:function(){var a=this,b=new k.Defer,c=a.fire("getTpl",{next:function(a){b.resolve(a)}});return b.promise.then(function(b){a.set("tpl",b)}),c?b.promise:void 0},bxBuildTpl:function(){return this.bxIBuildTpl?this.bxIBuildTpl():void 0},bxGetData:function(){var a=new k.Defer,b=this;return b.bxHandleRemote(function(b){a.resolve(b)}),a.promise.then(function(a){b.set("data",a)}),a.promise},bxAfterGetData:function(){var a=new k.Defer,b=this,c=b.fire("getData",{next:function(b){a.resolve(b)}});return a.promise.then(function(a){b.set("data",a)}),c?a.promise:void 0},bxBuildData:function(){var a=this,b=a.get("data");return b?!0:void 0},bxRender:function(){function b(){c.fire("afterRender"),d.resolve()}var c=this;if(c.get("autoRender")&&!c.get("rendered")){var d=new k.Defer;c.fire("beforeRender");var e=c.get("tpl"),f=c.get("el");if(e){var g=a.trim(c.bxRenderTpl(e,c.get("data")));f.html(g)}return c.bxDelegate(),c.on("rendered",function(){b(),c.detach("rendered",b)}),c.bxHandleName(f),d.promise}},bxRenderTpl:function(a,b){var c=this,d=c.get("TplEngine");return"function"==typeof d?new d(a).render(b):d.render(a,b)},bxActivate:function(){function b(){d.fire("activated")}function c(a){++g===f&&b(),a.target.detach("activated",c)}var d=this;if(d.get("autoActivate")&&!d.get("activated")&&d.get("rendered")){d.bxBind(),d.bxSync(),d.bxIActivate&&d.bxIActivate(),d.setInternal("activated",!0);for(var e=d.get("children"),f=e.length,g=0,h=0;h<e.length;h++){var i=e[h];i.on("activated",c),i.bxActivate()}e&&0!==e.length||a.later(b,0)}},bxBind:function(){var a=this;a.fire("beforeBind"),a.constructor.superclass.bindInternal.call(a),a.callMethodByHierarchy("bind","__bind"),a.fire("afterBind")},bxSync:function(){var a=this;a.fire("beforeSync"),o.superclass.syncInternal.call(a),a.callMethodByHierarchy("sync","__sync"),a.fire("afterSync")},destructor:function(){var a,b=this,c=b.get("children");for(a=c.length-1;a>=0;a--)c[a].destroy();b.set("children",[]);var d=b.get("parent");if(d){var e=d.get("children"),f=b.get("id");for(a=e.length-1;a>=0;a--)if(e[a].get("id")===f){e.splice(a,1);break}}if(b.get("rendered")){var g=b.get("el");switch(b.bxUndelegate(),b.get("destroyAction")){case"remove":g.remove();break;case"empty":g.empty()}}b.set("destroyed",!0)},boot:function(){return this.constructor.boot.apply(this,arguments)},fire:function(a,b,c){o.superclass.fire.apply(this,arguments);var d=this.get("parent");if(d)if(c=c||this,c===this){var e="#"+c.get("id")+"_"+a,f=c.get("name")+"_"+a;d.fire(e,b,c),d.fire(f,b,c)}else d.fire(a,b,c)}},{ATTRS:a.mix({tpl:{value:null},data:{value:null},rendered:{value:!1},activated:{value:!1},el:{getter:function(b){return a.isString(b)&&(b=a.one(b)),b},setter:function(b){if(a.isString(b)&&(b=a.one(b)),!b.attr("id")){for(var c;(c=a.guid("brix-brick-"))&&a.one("#"+c););b.attr("id",c)}return"#"+b.attr("id")}},id:{value:null},name:{value:null},autoRender:{value:!0},autoActivate:{value:!0},config:{value:{}},TplEngine:{value:m},destroyed:{value:!1},destroyAction:{value:"remove"},events:{},children:{value:[]},parent:{value:!1}},c.ATTRS)},"Brick");return a.augment(o,d,e,f,g,h,i,j,c.METHODS),a.mix(o,{boot:function(b,c){var d;if(a.isPlainObject(b)?b.el?(c=null,d=b):d={data:b,el:"[bx-app]"}:d=a.isString(b)?{el:b,data:c}:{},b=d.el,(!b||a.isString(b))&&(b=a.one(b||"[bx-app]")),!b)throw new Error("Cannot find el!");d.el=b,d.parent=this;var e=this.get("children");e||(e=[],this.set("children",e));var f=new o(d);return e.push(f),f}}),o},{requires:["brix/app/config","brix/interface/index","brix/core/bx-util","brix/core/bx-tpl","brix/core/bx-name","brix/core/bx-event","brix/core/bx-delegate","brix/core/bx-config","brix/core/bx-remote","promise","rich-base","xtemplate","node","event","sizzle"]}),KISSY.add("brix/core/bx-config",function(a){var b={bxHandleConfig:function(a,b){var c=a.attr("bx-config");return c?new Function("return "+c)():{}},bxCastString:function(b){return b=a.trim(b),/^(?:true|false)$/.test(b)?"true"===b:/^\d+$/.test(b)?parseInt(b,10):b}};return b}),KISSY.add("brix/core/bx-delegate",function(){var a={delegate:function(a,b,c,d){this.on(a+"_"+b,c,d)},undelegate:function(a,b,c,d){this.detach(a+"_"+b,c,d)}};return a},{requires:["event"]}),KISSY.add("brix/core/bx-event",function(a){var b={bxDelegate:function(){for(var a=this.constructor;a;)this.bxDelegateMap(a.EVENTS),a=a.superclass?a.superclass.constructor:null;var b=this.get("events");b&&this.bxDelegateMap(b)},bxDelegateMap:function(b){var c=this.get("el"),d=a.Event;for(var e in b){var f=b[e];for(var g in f){var h=f[g];"self"===e?c.on(g,h,this):"window"===e?d.on(window,g,h,this):"body"===e?d.on("body",g,h,this):"document"===e?d.on(document,g,h,this):c.delegate(g,e,h,this)}}},bxUndelegate:function(){for(var a=this.constructor;a;)this.bxUndelegateMap(a.EVENTS),a=a.superclass?a.superclass.constructor:null;var b=this.get("events");b&&this.bxUndelegateMap(b)},bxUndelegateMap:function(b){var c=this.get("el"),d=a.Event;for(var e in b){var f=b[e];for(var g in f){var h=f[g];"self"===e?c.detach(g,h,this):"window"===e?d.detach(window,g,h,this):"body"===e?d.detach("body",g,h,this):"document"===e?d.detach(document,g,h,this):c.undelegate(g,e,h,this)}}}};return b},{requires:["event"]}),KISSY.add("brix/core/bx-name",function(a,b){var c={bxHandleName:function(c){function d(a){++j===l&&(k.setInternal("rendered",!0),k.fire("rendered")),a.target.detach("rendered",d)}c=b(c);var e,f,g,h=this.bxDirectChildren(c),i=this.get("children")||[];for(e=h.length-1;e>=0;e--)for(g=h[e],f=0;f<i.length;f++)i[f].get("id")===g.attr("id")&&h.splice(e,1);var j=0,k=this,l=h.length;if(0===l)a.later(function(){k.setInternal("rendered",!0),k.fire("rendered")},0);else{var m,n=[];for(e=0;l>e;e++)g=b(h[e]),m=g.hasAttr("bx-naked")&&(g.attr("bx-naked")||"all"),n[e]="js"===m||"all"===m?"brix/base":g.attr("bx-name").replace(/\/?$/,"/index");KISSY.use(n.join(","),function(a){var b=a.makeArray(arguments);b.shift();for(var c=0;c<b.length;c++)k.bxInstantiate(h[c],b[c],d)})}},bxInstantiate:function(b,c,d){var e=this;if(a.isFunction(c)){var f,g=e.bxHandleConfig(b,c),h=b.attr("bx-tag");a.mix(g,{el:b,name:b.attr("bx-name"),parent:e,tag:h,brickTpl:h?e.get("brickTpls")[h].middle:null});for(var i=e;i;){var j=i.get("config");j&&(a.mix(g,j[b.attr("id")]),a.mix(g,j[b.attr("name")])),i=i.get("parent")}f=new c(g);var k=e.get("children");k||(k=[],e.set("children",k)),k.push(f),f.bxRender?f.on("rendered",d):d(),b=null}},bxDirectChildren:function(a,b){var c=[],d=this.get("name");return b=b||"[bx-name]",a.all(b).each(function(a){var b=a.parent("[bx-name]");b&&b.attr("bx-name")!==d||c.push(a)}),c},find:function(a){for(var b=this.get("children"),c=a.indexOf("/")>0,d="#"===a.charAt(0),e=0;e<b.length;e++){var f=b[e];if(c&&f.get("name")===a)return f;if(d&&"#"+f.get("id")===a)return f}}};return c},{requires:["node","sizzle","event"]}),KISSY.add("brix/core/bx-remote",function(a,b,c,d){var e={bxHandleRemote:function(c){var e=this,f=e.get("el"),g=e.get("data");if(g)return c(g);var h=f.attr("bx-remote");if(/^http/.test(h)){var i=new d(h);i.isSameOriginAs(new d(location.href))||e.bxJsonpRemote(i,c)}else{if(!/^\.\//.test(h))return c();var j=e.get("name"),k=j.replace(/\/?$/,"")+h.substr(1);b.config("debug")?e.bxXhrRemote(k,c):a.use(k,function(a,b){c(b)})}},bxJsonpRemote:function(a,b){for(var d,e=a.getQuery(),f=e.keys(),g=0;g<f.length;g++){var h=f[g];if("callback"===h||"callback"===e.get(h)){d=h,e.remove(h);break}}c({dataType:"jsonp",url:a.toString(),jsonp:d,success:b})},bxXhrRemote:function(a,b){if(!/^http/.test(location.href))throw Error("Cannot load data.json via xhr in current mode.");c.get(this.bxResolveModule(a,".json"),b)}};return e},{requires:["brix/app/config","ajax","uri"]}),KISSY.add("brix/core/bx-tpl",function(a,b,c){var d={bxHandleTpl:function(a){var b=this,c=b.get("el"),d=b.get("tpl")||c.attr("bx-tpl");if(d)if("#"===d.charAt(0))b.bxScriptTpl(d,a);else if("."===d)b.bxHereTpl(c,a);else if(/^\.\//.test(d))b.bxRemoteTpl(c.attr("bx-name").replace(/\/?$/,"")+d.substr(1),a);else if("cached"===d){for(var e=!1,f=c;(f=f.parent())&&f!==c;){if(f.attr("bx-each")){e=!0;break}if(f.attr("bx-name"))break}var g=b.get("parent").get("subTplsCache");a(e?g[0]:g.shift())}else a(d);else a()},bxScriptTpl:function(b,c){c(a.one(b).html())},bxHereTpl:function(a,b){b(a.html())},bxRemoteTpl:function(c,d){b.config("debug")?this.bxXhrTpl(c,d):a.use(c,function(a,b){d(b)})},bxXhrTpl:function(a,b){if(!/^http/.test(location.href))throw Error("Cannot load tpl via xhr in current mode.");c.get(this.bxResolveModule(a,".html"),b)}};return d},{requires:["brix/app/config","ajax","node","sizzle"]}),KISSY.add("brix/core/bx-util",function(a,b){var c={bxResolveModule:function(c,d){var e=c.split("/"),f=e.shift(),g=e.shift(),h=e.shift(),i=a.config("packages")[f].base,j=b.config("imports");return new RegExp(f+"\\/?$").test(i)||e.push(f),j&&j[f]?(e.push(g),e.push(j[f][g])):e.push(g),e.push(h+d),i+e.join("/")}};return c},{requires:["brix/app/config"]}),KISSY.add("brix/interface/if-yicai",function(){var a={};return a.METHODS={bxIBuildTpl:function(a){var b=this.bxDirectChildren(a),c=this.get("subTplsCache");c||(c=[],this.set("subTplsCache",c));for(var d=0;d<b.length;d++){var e=b[d],f=e.attr("bx-tpl");!e.attr("bx-model")||f&&"."!==f||(c.push(e.html()),e.html(""),e.attr("bx-tpl","cached"))}}},a.ATTRS={subTplsCache:{value:[]}},a}),KISSY.add("brix/interface/if-zuomo",function(a){var b={};return b.METHODS={bxIBuildTpl:function(){var a=this,b=a.get("tpl");if(b)return b=a.bxITag(b),b=a.bxISubTpl(b),a.bxIBuildStoreTpls(b),a.set("tpl",b),a.bxIBuildSubTpls(a.bxIBuildBrickTpls(b)),!0;var c=a.get("brickTpl");return c&&a.bxIBuildSubTpls(a.bxIBuildBrickTpls(c)),!1},bxIActivate:function(){var a=this;a.on("beforeRefreshTpl",function(b){if("html"===b.renderType)for(var c=a.bxDirectChildren(b.node),d=0;d<c.length;d++)a.find("#"+c[d].attr("id")).destroy()}),a.on("afterRefreshTpl",function(b){a.bxHandleName(b.node)})},bxIBuildStoreTpls:function(a){var b=this,c=b.get("storeTpls"),d=/\{\{#bx\-store\-tpl\-([^\}]*)?\}\}([\s\S]*?)\{\{\/bx\-store\-tpl\}\}/gi;return a=a.replace(d,function(a,b,d){return c[b]=d,""})},bxITag:function(b){return b.replace(/(bx-tag=["'][^"']+["'])/gi,"").replace(/(bx-name=["'][^"']+["'])/gi,function(b){return b+' bx-tag="brix_tag_'+a.guid()+'"'})},bxISubTpl:function(b){return b.replace(/(bx-subtpl=["'][^"']+["'])/gi,"").replace(/(bx-datakey=["'][^"']+["'])/gi,function(b){return'bx-subtpl="brix_subtpl_'+a.guid()+'" '+b})},bxIBuildBrickTpls:function(a){for(var b=this,c="(<([\\w]+)\\s+[^>]*?bx-name=[\"']([^\"']+)[\"']\\s+bx-tag=[\"']([^\"']+)[\"']\\s*[^>]*?>)(@brix@)(</\\2>)",d=b.get("brickTpls"),e=b.get("level");e--;)c=c.replace("@brix@","(?:<\\2[^>]*>@brix@</\\2>|[\\s\\S])*?");c=c.replace("@brix@","(?:[\\s\\S]*?)");var f=new RegExp(c,"ig");return a=a.replace(f,function(a,b,c,e,f,g,h){return d[f]={start:b,middle:g,end:h},"@brix@"+f+"@brix@"})},bxIBuildSubTpls:function(a){for(var b=this,c=b.get("subTpls"),d=b.get("brickTpls"),e=b.get("level"),f="(<([\\w]+)\\s+[^>]*?bx-subtpl=[\"']([^\"']+)[\"']\\s+bx-datakey=[\"']([^\"']+)[\"']\\s*[^>]*?>(@brix@)</\\2>)";e--;)f=f.replace("@brix@","(?:<\\2[^>]*>@brix@</\\2>|[\\s\\S])*?");f=f.replace("@brix@","(?:[\\s\\S]*?)");for(var g,h=new RegExp(f,"ig"),i=function(a,b){var c=d[b];return c.start+c.middle+c.end};null!==(g=h.exec(a));)c.push({name:g[3],datakey:g[4],tpl:g[5].replace(/@brix@(brix_tag_\d+)@brix@/gi,i)}),b.bxIBuildSubTpls(g[5])},bxIRefreshTpl:function(b,c,d){var e=this;if(e.get("rendered")){var f=e.get("el"),g=e.get("subTpls");a.each(g,function(g){for(var h=a.map(g.datakey.split(","),function(b){return a.trim(b)}),i=!1,j=0;j<h.length;j++)for(var k=0;k<b.length;k++)if(h[j]==b[k]){i=!0;break}if(i){var l=f.all("[bx-subtpl="+g.name+"]");f.attr("bx-subtpl")==g.name&&(l=f.add(l)),l.each(function(b){e.fire("beforeRefreshTpl",{node:b,renderType:d});var f={};a.each(h,function(a){for(var b=c,d=a.split("."),e=d.length,g=0;g!==e;)b=b[d[g]],g++;f[d[e-1]]=b,b=null}),a.each(c,function(b,c){a.isFunction(b)&&(f[c]=b)}),l[d](a.trim(e.bxRenderTpl(g.tpl,f))),e.fire("afterRefreshTpl",{node:b,renderType:d})})}});for(var h=e.get("children"),i=0;i<h.length;i++){var j=h[i];j.get("refresh")||(j.set("refresh",!0),j.get("data")||(j.bxIRefreshTpl(b,c,d),i=0))}a.each(h,function(a){a.set("refresh",!1)})}},setChunkData:function(b,c,d){for(var e,f=this,g=f;g&&(!(e=g.get("data"))||!e);)g=g.get("parent");e||(e={},g=f);var h=[];if(a.isObject(b)){for(var i in b)e[i]=b[i],h.push(i);d=c}else h=[b],e[b]=c;var j="html";d&&d.renderType&&(j=d.renderType,delete d.renderType),g.set("data",e,d),d&&d.silent||f.bxIRefreshTpl(h,e,j)}},b.ATTRS={subTpls:{value:[]},storeTpls:{value:[]},level:{value:4},brickTpl:{value:!1},brickTpls:{value:{}}},b}),KISSY.add("brix/interface/index",function(a,b,c,d){var e={zuomo:c,yicai:d};return e[b.config("interface")]},{requires:["brix/app/config","brix/interface/if-zuomo","brix/interface/if-yicai"]});